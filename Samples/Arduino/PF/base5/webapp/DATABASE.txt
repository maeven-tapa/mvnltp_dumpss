
CREATE DATABASE IF NOT EXISTS bitesnbowls_db;
USE bitesnbowls_db;


CREATE TABLE IF NOT EXISTS `users` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(50) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


INSERT INTO `users` (`username`, `password`) VALUES 
('admin', '1234')
ON DUPLICATE KEY UPDATE username = username;


CREATE TABLE IF NOT EXISTS `schedules` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `interval_type` VARCHAR(20) NOT NULL,
  `start_time` TIME NOT NULL,
  `rounds` INT(11) NOT NULL,
  `frequency` VARCHAR(20) NOT NULL,
  `custom_days` VARCHAR(100) DEFAULT NULL,
  `is_active` TINYINT(1) DEFAULT 1,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE IF NOT EXISTS `history` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `feed_date` DATE NOT NULL,
  `feed_time` TIME NOT NULL,
  `rounds` INT(11) NOT NULL,
  `type` VARCHAR(20) NOT NULL,
  `status` VARCHAR(50) NOT NULL,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE IF NOT EXISTS `alerts` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `alert_type` VARCHAR(20) NOT NULL,
  `message` TEXT NOT NULL,
  `is_read` TINYINT(1) DEFAULT 0,
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


CREATE TABLE IF NOT EXISTS `device_settings` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `setting_key` VARCHAR(50) NOT NULL,
  `setting_value` VARCHAR(255) NOT NULL,
  `updated_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `setting_key` (`setting_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `command_queue` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `command_type` VARCHAR(50) NOT NULL,
  `command_data` VARCHAR(255) NOT NULL,
  `status` VARCHAR(20) DEFAULT 'pending',
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  `executed_at` TIMESTAMP NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

CREATE TABLE `feeding_analytics` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `date` DATE NOT NULL,
  `total_rounds` INT(11) DEFAULT 0,
  `total_weight` INT(11) DEFAULT 0,
  `manual_feeds` INT(11) DEFAULT 0,
  `scheduled_feeds` INT(11) DEFAULT 0,
  PRIMARY KEY (`id`),
  UNIQUE KEY `date` (`date`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO `device_settings` (`setting_key`, `setting_value`) VALUES
('wifi_ssid', 'Bites_n_Bowls'),
('timezone', 'PST (UTC-8)'),
('battery_level', '85'),
('current_weight', '1000'),
('is_connected', '1'),
('firmware_version', 'v2.1.0'),
('last_calibration', 'N/A')
ON DUPLICATE KEY UPDATE setting_key = setting_key;

INSERT INTO `device_settings` (`setting_key`, `setting_value`) VALUES
('last_heartbeat', NOW()),
('wifi_signal', '80')
ON DUPLICATE KEY UPDATE setting_key = setting_key;
